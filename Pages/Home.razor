@page "/"

<PageTitle>图像格式转换</PageTitle>

<MudText Typo="Typo.h4" GutterBottom="true">图像格式转换器</MudText>
<MudText Typo="Typo.body1" Class="mb-4" Color="MudBlazor.Color.Secondary">
    上传图像文件，选择目标格式，在浏览器内完成转换并下载。
</MudText>

<MudPaper Class="pa-4" Elevation="2">
    <MudText Typo="Typo.h6" GutterBottom="true">上传图像</MudText>

    <MudFileUpload T="IBrowserFile"
                   Accept="@ImageFormatInfo.AcceptExtensions"
                   FilesChanged="OnFileSelected"
                   MaximumFileCount="1">
        <ActivatorContent>
            <MudPaper Outlined="true"
                      Class="@GetDragClass()"
                      Style="min-height: 200px; cursor: pointer;"
                      @ondrop="ClearDragClass"
                      @ondragenter="SetDragClass"
                      @ondragleave="ClearDragClass"
                      @ondragend="ClearDragClass">
                <MudIcon Icon="@Icons.Material.Filled.CloudUpload" Size="MudBlazor.Size.Large" Color="MudBlazor.Color.Primary" />
                <MudText Typo="Typo.body1">点击或拖拽图像文件到此处</MudText>
                <MudText Typo="Typo.caption" Color="MudBlazor.Color.Secondary">
                    支持 @string.Join(", ", ImageFormatInfo.EncodableFormats.Select(f => f.Name))
                </MudText>
            </MudPaper>
        </ActivatorContent>
    </MudFileUpload>
</MudPaper>

@if (_file is not null)
{
    <ImageConversionCard @key="_file" File="_file" />
}

@code {
    private const string DefaultDragClass = "rounded-lg border-2 border-dashed pa-4 d-flex flex-column align-center justify-center gap-2";

    private bool _dragging;
    private IBrowserFile? _file;

    private string GetDragClass() =>
        _dragging ? $"{DefaultDragClass} mud-border-primary" : DefaultDragClass;

    private void OnFileSelected(IBrowserFile file)
    {
        _file = file;
    }

    private void SetDragClass() => _dragging = true;
    private void ClearDragClass() => _dragging = false;
}
