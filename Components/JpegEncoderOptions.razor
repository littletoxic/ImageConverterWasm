@using SixLabors.ImageSharp.Formats
@using SixLabors.ImageSharp.Formats.Jpeg
@attribute [FormatEncoder(typeof(JpegFormat))]
@inherits EncoderOptionsBase

<MudText Typo="Typo.body2" Class="mb-2">JPEG 质量：@_quality</MudText>
<MudSlider T="int" Value="_quality" ValueChanged="OnQualityChanged"
           Min="1" Max="100" Step="1" Color="MudBlazor.Color.Primary" Class="mb-4" />

<MudExpansionPanels Elevation="0" Dense="true" Class="mb-2 border-solid border rounded mud-border-primary">
    <MudExpansionPanel>
        <TitleContent>
            <div class="d-flex align-center">
                <MudIcon Icon="@Icons.Material.Filled.Tune" Size="MudBlazor.Size.Small" Class="mr-2" Color="MudBlazor.Color.Primary" />
                <MudText Typo="Typo.body2" Color="MudBlazor.Color.Primary">高级选项</MudText>
            </div>
        </TitleContent>
        <ChildContent>
        <MudSelect T="JpegEncodingColor?" Value="_colorType" ValueChanged="OnColorTypeChanged"
                   Label="色彩编码" Variant="Variant.Outlined" Class="mb-4">
            <MudSelectItem T="JpegEncodingColor?" Value="@((JpegEncodingColor?)null)">自动</MudSelectItem>
            <MudSelectItem T="JpegEncodingColor?" Value="JpegEncodingColor.YCbCrRatio444">YCbCr 4:4:4（高质量）</MudSelectItem>
            <MudSelectItem T="JpegEncodingColor?" Value="JpegEncodingColor.YCbCrRatio420">YCbCr 4:2:0（更小）</MudSelectItem>
            <MudSelectItem T="JpegEncodingColor?" Value="JpegEncodingColor.Luminance">灰度</MudSelectItem>
            <MudSelectItem T="JpegEncodingColor?" Value="JpegEncodingColor.Rgb">RGB</MudSelectItem>
        </MudSelect>
        </ChildContent>
    </MudExpansionPanel>
</MudExpansionPanels>

@code {
    private int _quality = 90;
    private JpegEncodingColor? _colorType;

    private async Task OnQualityChanged(int value)
    {
        _quality = value;
        await NotifyEncoderChanged();
    }

    private async Task OnColorTypeChanged(JpegEncodingColor? value)
    {
        _colorType = value;
        await NotifyEncoderChanged();
    }

    protected override IImageEncoder BuildEncoder() =>
        new JpegEncoder
        {
            Quality = _quality,
            ColorType = _colorType,
            SkipMetadata = SkipMetadata
        };
}
