@using SixLabors.ImageSharp.Formats
@using SixLabors.ImageSharp.Formats.Bmp
@attribute [FormatEncoder(typeof(BmpFormat))]
@inherits EncoderOptionsBase

<MudSelect T="BmpBitsPerPixel?" Value="_bitsPerPixel" ValueChanged="OnBitsPerPixelChanged"
           Label="位深度" Variant="Variant.Outlined" Class="mb-4">
    <MudSelectItem T="BmpBitsPerPixel?" Value="@((BmpBitsPerPixel?)null)">自动</MudSelectItem>
    <MudSelectItem T="BmpBitsPerPixel?" Value="BmpBitsPerPixel.Pixel8">8 位（256 色）</MudSelectItem>
    <MudSelectItem T="BmpBitsPerPixel?" Value="BmpBitsPerPixel.Pixel16">16 位</MudSelectItem>
    <MudSelectItem T="BmpBitsPerPixel?" Value="BmpBitsPerPixel.Pixel24">24 位</MudSelectItem>
    <MudSelectItem T="BmpBitsPerPixel?" Value="BmpBitsPerPixel.Pixel32">32 位</MudSelectItem>
</MudSelect>

<MudSwitch T="bool" Value="_supportTransparency" ValueChanged="OnSupportTransparencyChanged"
           Color="MudBlazor.Color.Primary"
           Label="支持透明（仅 32 位）" />

@code {
    private BmpBitsPerPixel? _bitsPerPixel;
    private bool _supportTransparency;

    private async Task OnBitsPerPixelChanged(BmpBitsPerPixel? value)
    {
        _bitsPerPixel = value;
        await NotifyEncoderChanged();
    }

    private async Task OnSupportTransparencyChanged(bool value)
    {
        _supportTransparency = value;
        await NotifyEncoderChanged();
    }

    protected override IImageEncoder BuildEncoder() =>
        new BmpEncoder
        {
            BitsPerPixel = _bitsPerPixel,
            SupportTransparency = _supportTransparency,
            SkipMetadata = SkipMetadata
        };
}
